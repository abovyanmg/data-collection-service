================================================================================
                    ACS DATA COLLECTION SERVICE - ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ Ð¡Ð•Ð Ð’Ð•Ð Ð
================================================================================

ðŸ“‹ Ð˜ÐÐ¡Ð¢Ð Ð£ÐšÐ¦Ð˜Ð¯ ÐŸÐž ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ• Ð¡Ð•Ð Ð’Ð•Ð Ð Ð”Ð›Ð¯ ACS Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ«
================================================================================

ðŸŽ¯ Ð¦Ð•Ð›Ð¬: Ð Ð°Ð·Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ ACS ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ ÑÐ±Ð¾Ñ€Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð½Ð° Ð½Ð¾Ð²Ð¾Ð¼ ÑÐµÑ€Ð²ÐµÑ€Ðµ
ðŸ–¥ï¸ Ð¡Ð•Ð Ð’Ð•Ð : Ubuntu 24.04+ Ñ SSH Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð¾Ð¼
â±ï¸ Ð’Ð Ð•ÐœÐ¯: 15-30 Ð¼Ð¸Ð½ÑƒÑ‚

================================================================================
Ð¨ÐÐ“ 1: ÐŸÐžÐ”ÐšÐ›Ð®Ð§Ð•ÐÐ˜Ð• Ðš Ð¡Ð•Ð Ð’Ð•Ð Ð£
================================================================================

# ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÐµÑÑŒ Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ Ð¿Ð¾ SSH
ssh root@YOUR_SERVER_IP

# Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ ÑÐµÑ€Ð²ÐµÑ€Ð° ÐºÐ¾Ð³Ð´Ð° Ð¿Ð¾Ð¿Ñ€Ð¾ÑÐ¸Ñ‚

================================================================================
Ð¨ÐÐ“ 2: ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐ˜Ð• Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ«
================================================================================

# ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð¿Ð°ÐºÐµÑ‚Ñ‹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
sudo apt update && sudo apt upgrade -y

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ðµ Ð¿Ð°ÐºÐµÑ‚Ñ‹
sudo apt install -y curl wget git unzip

================================================================================
Ð¨ÐÐ“ 3: Ð£Ð¡Ð¢ÐÐÐžÐ’ÐšÐ DOCKER (ÐµÑÐ»Ð¸ Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½)
================================================================================

# ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð¿Ð°ÐºÐµÑ‚Ñ‹
sudo apt update

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
sudo apt install -y apt-transport-https ca-certificates curl software-properties-common

# Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð¾Ñ„Ð¸Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ð¹ GPG ÐºÐ»ÑŽÑ‡ Docker
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

# Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹ Docker
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²
sudo apt update

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Docker CE
sudo apt install -y docker-ce

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ Docker (Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ctrl+C Ð´Ð»Ñ Ð²Ñ‹Ñ…Ð¾Ð´Ð°)
sudo systemctl status docker

# Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð² Ð³Ñ€ÑƒÐ¿Ð¿Ñƒ docker (Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð±ÐµÐ· sudo)
sudo usermod -aG docker $USER

# ÐŸÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÐµÑÑŒ Ð¸Ð»Ð¸ Ð²Ñ‹Ð¹Ð´Ð¸Ñ‚Ðµ/Ð²Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ
exit
ssh root@YOUR_SERVER_IP

================================================================================
Ð¨ÐÐ“ 4: Ð£Ð¡Ð¢ÐÐÐžÐ’ÐšÐ DOCKER COMPOSE
================================================================================

# Ð¡ÐºÐ°Ñ‡Ð°Ð¹Ñ‚Ðµ Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

# Ð¡Ð´ÐµÐ»Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» Ð¸ÑÐ¿Ð¾Ð»Ð½ÑÐµÐ¼Ñ‹Ð¼
sudo chmod +x /usr/local/bin/docker-compose

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÑƒ
docker-compose --version

================================================================================
Ð¨ÐÐ“ 5: ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ Ð¤ÐÐ™Ð Ð’ÐžÐ›Ð
================================================================================

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ñ„Ð°Ð¹Ñ€Ð²Ð¾Ð»
sudo apt install -y ufw

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°
sudo ufw allow ssh
sudo ufw allow 8123
sudo ufw allow 9000

# Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ñ„Ð°Ð¹Ñ€Ð²Ð¾Ð»
sudo ufw enable

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ
sudo ufw status

================================================================================
Ð¨ÐÐ“ 6: ÐšÐ›ÐžÐÐ˜Ð ÐžÐ’ÐÐÐ˜Ð• ACS ÐŸÐ ÐžÐ•ÐšÐ¢Ð
================================================================================

# ÐšÐ»Ð¾Ð½Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹ ACS
git clone https://github.com/abovyanmg/data-collection-service.git

# ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð² Ð¿Ð°Ð¿ÐºÑƒ ÐºÐ»Ð¸ÐµÐ½Ñ‚ÑÐºÐ¾Ð¹ Ñ‡Ð°ÑÑ‚Ð¸
cd data-collection-service/client

# Ð¡ÐºÐ°Ñ‡Ð°Ð¹Ñ‚Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ñ‹Ð¹ docker-compose.yml
wget https://raw.githubusercontent.com/abovyanmg/data-collection-service/main/client/docker-compose.yml

# Ð¡ÐºÐ°Ñ‡Ð°Ð¹Ñ‚Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº
wget https://raw.githubusercontent.com/abovyanmg/data-collection-service/main/admin/examples/settings.xlsx

# Ð¡ÐºÐ°Ñ‡Ð°Ð¹Ñ‚Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹
wget https://raw.githubusercontent.com/abovyanmg/data-collection-service/main/admin/examples/config.xml
wget https://raw.githubusercontent.com/abovyanmg/data-collection-service/main/admin/examples/users.xml

================================================================================
Ð¨ÐÐ“ 7: ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ ÐŸÐ•Ð Ð•ÐœÐ•ÐÐÐ«Ð¥ ÐžÐšÐ Ð£Ð–Ð•ÐÐ˜Ð¯
================================================================================

# Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» .env
cat > .env << EOF
# ClickHouse Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
CLICKHOUSE_HOST=my_clickhouse
CLICKHOUSE_PORT=8123
CLICKHOUSE_USER=default
CLICKHOUSE_PASSWORD=your_secure_password

# Telegram ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
PROJECT_NAME=MyProject
PLATFORM=ozon,wb,mskld,yandex,vk,getcourse

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ÑÐµÑ€Ð²ÐµÑ€Ð°
TZ=Europe/Moscow
EOF

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð¿Ñ€Ð°Ð²Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°
chmod 600 .env

================================================================================
Ð¨ÐÐ“ 8: ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ Ð¤ÐÐ™Ð›Ð SETTINGS.XLSX
================================================================================

# Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº
cp settings.xlsx settings_my_project.xlsx

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð¿Ñ€Ð°Ð²Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°
chmod 644 settings_my_project.xlsx

# Ð’ÐÐ–ÐÐž: ÐžÑ‚Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ settings_my_project.xlsx
# Ð—Ð°Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ð»Ð¸ÑÑ‚Ñ‹: settings, users, ozon, wb, mskld
# Ð£ÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð²Ð°ÑˆÐ¸ Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ðµ API ÐºÐ»ÑŽÑ‡Ð¸ Ð¸ Ñ‚Ð¾ÐºÐµÐ½Ñ‹

================================================================================
Ð¨ÐÐ“ 8.5: ÐŸÐžÐ”Ð“ÐžÐ¢ÐžÐ’ÐšÐ DOCKER Ð Ð•Ð¡Ð£Ð Ð¡ÐžÐ’
================================================================================

# Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Docker volume Ð´Ð»Ñ ClickHouse
docker volume create clickhouse_volume

# Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Docker network Ð´Ð»Ñ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²
docker network create --driver bridge chnet

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ€ÐµÑÑƒÑ€ÑÑ‹
docker volume ls | grep clickhouse_volume
docker network ls | grep chnet

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð´ÐµÑ‚Ð°Ð»Ð¸ volume
docker volume inspect clickhouse_volume

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð´ÐµÑ‚Ð°Ð»Ð¸ network
docker network inspect chnet

================================================================================
Ð¨ÐÐ“ 9: Ð—ÐÐŸÐ£Ð¡Ðš Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ«
================================================================================

# Ð¡ÐŸÐžÐ¡ÐžÐ‘ 1: Ð§ÐµÑ€ÐµÐ· Docker Compose (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ)
docker compose up -d

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²
docker compose ps

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²
docker stats --no-stream

================================================================================
Ð¨ÐÐ“ 9.1: ÐÐ›Ð¬Ð¢Ð•Ð ÐÐÐ¢Ð˜Ð’ÐÐ«Ð™ Ð—ÐÐŸÐ£Ð¡Ðš (Ð¿Ñ€ÑÐ¼Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ docker run)
================================================================================

# Ð•ÑÐ»Ð¸ Docker Compose Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð¿Ñ€ÑÐ¼Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹:

# Ð’ÐÐ–ÐÐž: Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð¸ ÑƒÐ´Ð°Ð»Ð¸Ñ‚Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹ (ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ)
docker stop my_clickhouse upload_data 2>/dev/null || true
docker rm my_clickhouse upload_data 2>/dev/null || true

# 1. Ð—Ð°Ð¿ÑƒÑÐº ClickHouse Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÐµÐ¹
docker run -d --name my_clickhouse --network chnet \
  -p 8123:8123 -p 9000:9000 \
  -v clickhouse_volume:/var/lib/clickhouse \
  -v "/root/data-collection-service/client/config.xml:/etc/clickhouse-server/config.xml" \
  -v "/root/data-collection-service/client/users.xml:/etc/clickhouse-server/users.xml" \
  --user clickhouse abovyanmg/acs-clickhouse:latest

# 2. ÐŸÐ¾Ð´Ð¾Ð¶Ð´Ð¸Ñ‚Ðµ 30 ÑÐµÐºÑƒÐ½Ð´ Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° ClickHouse
sleep 30

# 3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ ClickHouse Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ð»ÑÑ
curl http://localhost:8123/ping

# 4. Ð—Ð°Ð¿ÑƒÑÐº ÑÐ±Ð¾Ñ€Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…
docker run -d --name upload_data --network chnet \
  -v "/root/data-collection-service/client/settings.xlsx:/app/settings.xlsx" \
  abovyanmg/acs-upload-data:latest

# 5. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð½Ñ‹Ñ… ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²
docker ps

# 6. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð»Ð¾Ð³Ð¾Ð² ClickHouse
docker logs my_clickhouse

# 7. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð»Ð¾Ð³Ð¾Ð² ÑÐ±Ð¾Ñ€Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…
docker logs upload_data

# 8. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº ClickHouse
curl http://localhost:8123/ping

# 9. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… (ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾)
# ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÐµÑÑŒ Ðº ClickHouse Ð¸ ÑÐ¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ…
docker exec -it my_clickhouse clickhouse-client --query "CREATE DATABASE IF NOT EXISTS acs_data"

# 10. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…
docker exec -it my_clickhouse clickhouse-client --query "SHOW DATABASES"

================================================================================
Ð¨ÐÐ“ 9.2: Ð—ÐÐŸÐ£Ð¡Ðš Ð”ÐžÐŸÐžÐ›ÐÐ˜Ð¢Ð•Ð›Ð¬ÐÐ«Ð¥ ÐšÐžÐÐ¢Ð•Ð™ÐÐ•Ð ÐžÐ’
================================================================================

# Ð”Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð² ÑÐ±Ð¾Ñ€Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…:

# Ð—Ð°Ð¿ÑƒÑÐº Ð²Ñ‚Ð¾Ñ€Ð¾Ð³Ð¾ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð° ÑÐ±Ð¾Ñ€Ð° (Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ð¼Ð¸)
docker run -d --name upload_data2 --network chnet \
  -v "/root/data-collection-service/client/settings2.xlsx:/app/settings.xlsx" \
  abovyanmg/acs-upload-data:latest

# Ð—Ð°Ð¿ÑƒÑÐº Ñ‚Ñ€ÐµÑ‚ÑŒÐµÐ³Ð¾ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð° ÑÐ±Ð¾Ñ€Ð°
docker run -d --name upload_data3 --network chnet \
  -v "/root/data-collection-service/client/settings3.xlsx:/app/settings.xlsx" \
  abovyanmg/acs-upload-data:latest

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð²ÑÐµÑ… ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"

================================================================================
Ð¨ÐÐ“ 9.3: ÐŸÐžÐ¨ÐÐ“ÐžÐ’Ð«Ð™ Ð—ÐÐŸÐ£Ð¡Ðš (Ð´Ð»Ñ Ð¿Ð¾Ð»Ð½Ð¾Ð¹ Ð°Ð²Ñ‚Ð¾Ð½Ð¾Ð¼Ð½Ð¾ÑÑ‚Ð¸)
================================================================================

# Ð•ÑÐ»Ð¸ Ð²Ñ‹ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ Ð¿Ð¾ÑˆÐ°Ð³Ð¾Ð²Ð¾ Ð±ÐµÐ· AI-Ð°ÑÑÐ¸ÑÑ‚ÐµÐ½Ñ‚Ð°:

# Ð¨ÐÐ“ 1: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð²ÑÐµ Ñ„Ð°Ð¹Ð»Ñ‹ Ð½Ð° Ð¼ÐµÑÑ‚Ðµ
ls -la /root/data-collection-service/client/
# Ð”Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ: config.xml, users.xml, settings.xlsx, .env

# Ð’ÐÐ–ÐÐž: Ð•ÑÐ»Ð¸ Ñ„Ð°Ð¹Ð»Ñ‹ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚, Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ð¸Ñ… Ð² /home/ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ, Ð·Ð°Ñ‚ÐµÐ¼ ÑÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ:
# cp /home/config.xml /root/data-collection-service/client/config.xml
# cp /home/users.xml /root/data-collection-service/client/users.xml  
# cp /home/settings.xlsx /root/data-collection-service/client/settings.xlsx

# Ð¨ÐÐ“ 2: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Docker Ñ€ÐµÑÑƒÑ€ÑÑ‹
docker volume ls | grep clickhouse_volume
docker network ls | grep chnet

# Ð¨ÐÐ“ 3: ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð¸ ÑƒÐ´Ð°Ð»Ð¸Ñ‚Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹ (ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ)
docker stop my_clickhouse upload_data 2>/dev/null || true
docker rm my_clickhouse upload_data 2>/dev/null || true

# Ð¨ÐÐ“ 3.1: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹ ÑƒÐ´Ð°Ð»ÐµÐ½Ñ‹
docker ps -a | grep -E "(my_clickhouse|upload_data)" || echo "ÐšÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹ - Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°Ñ‚ÑŒ"

# Ð¨ÐÐ“ 4: Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ ClickHouse
docker run -d --name my_clickhouse --network chnet \
  -p 8123:8123 -p 9000:9000 \
  -v clickhouse_volume:/var/lib/clickhouse \
  -v "/root/data-collection-service/client/config.xml:/etc/clickhouse-server/config.xml" \
  -v "/root/data-collection-service/client/users.xml:/etc/clickhouse-server/users.xml" \
  --user clickhouse abovyanmg/acs-clickhouse:latest

# Ð¨ÐÐ“ 5: ÐŸÐ¾Ð´Ð¾Ð¶Ð´Ð¸Ñ‚Ðµ 30 ÑÐµÐºÑƒÐ½Ð´ Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° ClickHouse
sleep 30

# Ð¨ÐÐ“ 6: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ ClickHouse Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ð»ÑÑ
curl http://localhost:8123/ping
# Ð”Ð¾Ð»Ð¶ÐµÐ½ Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ñ‚ÑŒ: Ok

# Ð¨ÐÐ“ 6.1: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð° ClickHouse
docker ps | grep my_clickhouse
# Ð”Ð¾Ð»Ð¶ÐµÐ½ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ: Up (running)

# Ð¨ÐÐ“ 6.2: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸ ClickHouse Ð½Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ¸
docker logs my_clickhouse | tail -20

# Ð¨ÐÐ“ 6.3: Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð² ClickHouse
docker exec -it my_clickhouse clickhouse-client --query "CREATE DATABASE IF NOT EXISTS acs_data"

# Ð¨ÐÐ“ 6.4: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…
docker exec -it my_clickhouse clickhouse-client --query "SHOW DATABASES"

# Ð¨ÐÐ“ 7: Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ ÑÐ±Ð¾Ñ€ Ð´Ð°Ð½Ð½Ñ‹Ñ…
docker run -d --name upload_data --network chnet \
  -v "/root/data-collection-service/client/settings.xlsx:/app/settings.xlsx" \
  abovyanmg/acs-upload-data:latest

# Ð¨ÐÐ“ 8: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð²ÑÐµÑ… ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²
docker ps

# Ð¨ÐÐ“ 8.1: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð° upload_data
docker ps | grep upload_data
# Ð”Ð¾Ð»Ð¶ÐµÐ½ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ: Up (running)

# Ð¨ÐÐ“ 9: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸
docker logs my_clickhouse | tail -10
docker logs upload_data | tail -10

# Ð¨ÐÐ“ 9.1: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸ upload_data Ð½Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ¸
docker logs upload_data | grep -i error || echo "ÐžÑˆÐ¸Ð±Ð¾Ðº Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾"

# Ð¨ÐÐ“ 10: Ð•ÑÐ»Ð¸ Ð²ÑÐµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚, ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð³Ð¾Ñ‚Ð¾Ð²Ð°!
echo "âœ… ACS ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð° Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚!"

================================================================================
Ð¨ÐÐ“ 9.4: ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ CLICKHOUSE Ð‘ÐÐ—Ð« Ð”ÐÐÐÐ«Ð¥
================================================================================

# Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ ACS ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
docker exec -it my_clickhouse clickhouse-client --query "CREATE DATABASE IF NOT EXISTS acs_data"

# Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ… (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)
docker exec -it my_clickhouse clickhouse-client --query "CREATE DATABASE IF NOT EXISTS test_data"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…
docker exec -it my_clickhouse clickhouse-client --query "SHOW DATABASES"

# Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)
docker exec -it my_clickhouse clickhouse-client --query "CREATE USER IF NOT EXISTS acs_user IDENTIFIED BY 'acs_password'"

# ÐŸÑ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ Ð¿Ñ€Ð°Ð²Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ
docker exec -it my_clickhouse clickhouse-client --query "GRANT ALL ON acs_data.* TO acs_user"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
docker exec -it my_clickhouse clickhouse-client --query "SHOW USERS"

================================================================================
Ð¨ÐÐ“ 10: ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð ÐÐ‘ÐžÐ¢Ð«
================================================================================

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸ ClickHouse
docker compose logs my_clickhouse

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸ ÑÐ±Ð¾Ñ€Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…
docker compose logs upload_data

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº ClickHouse
curl http://localhost:8123/ping

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ Ð¸Ð·Ð²Ð½Ðµ (ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾)
curl http://YOUR_SERVER_IP:8123/ping

================================================================================
Ð¨ÐÐ“ 11: ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ ÐœÐžÐÐ˜Ð¢ÐžÐ Ð˜ÐÐ“Ð
================================================================================

# Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°
cat > monitor_acs.sh << 'EOF'
#!/bin/bash

echo "ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ACS ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹..."

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚Ð°Ñ‚ÑƒÑ ClickHouse
if ! curl -s http://localhost:8123/ping | grep -q "Ok"; then
    echo "âŒ ClickHouse Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½"
    exit 1
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚Ð°Ñ‚ÑƒÑ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²
if ! docker compose ps | grep -q "Up"; then
    echo "âŒ ÐšÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ñ‹"
    exit 1
fi

echo "âœ… ACS ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð½Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ð¾"
EOF

# Ð¡Ð´ÐµÐ»Ð°Ð¹Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð¸ÑÐ¿Ð¾Ð»Ð½ÑÐµÐ¼Ñ‹Ð¼
chmod +x monitor_acs.sh

# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ
./monitor_acs.sh

================================================================================
Ð¨ÐÐ“ 12: ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ ÐÐ’Ð¢ÐžÐœÐÐ¢Ð˜Ð§Ð•Ð¡ÐšÐžÐ“Ðž ÐŸÐ•Ð Ð•Ð—ÐÐŸÐ£Ð¡ÐšÐ DOCKER ÐšÐžÐÐ¢Ð•Ð™ÐÐ•Ð ÐžÐ’
================================================================================

# Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº Ð´Ð»Ñ Ð²ÑÐµÑ… ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð² (ÐºÐ°Ðº Ñƒ ÐœÐ¾Ñ€Ð¸Ð½Ð°Ð´Ð°)
docker update --restart unless-stopped my_clickhouse
docker update --restart unless-stopped upload_data

# Ð”Ð»Ñ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð² (ÐµÑÐ»Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹)
docker update --restart unless-stopped upload_data_client_A 2>/dev/null || true
docker update --restart unless-stopped upload_data_client_B 2>/dev/null || true
docker update --restart unless-stopped upload_data_ozon_only 2>/dev/null || true
docker update --restart unless-stopped upload_data_wb_only 2>/dev/null || true
docker update --restart unless-stopped upload_data_test 2>/dev/null || true

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐºÐ°
docker inspect --format='{{.Name}}: {{.HostConfig.RestartPolicy.Name}}' $(docker ps -aq)

# Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð¼Ð°ÑÑÐ¾Ð²Ð¾Ð³Ð¾ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐºÐ°
cat > enable_restart.sh << 'EOF'
#!/bin/bash
echo "ðŸ”„ Ð’ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐºÐ° Ð´Ð»Ñ Ð²ÑÐµÑ… ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²..."

# ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹
docker update --restart unless-stopped my_clickhouse
docker update --restart unless-stopped upload_data

# Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹
for container in upload_data_client_A upload_data_client_B upload_data_ozon_only upload_data_wb_only upload_data_test; do
    if docker ps -a --format '{{.Names}}' | grep -q "^${container}$"; then
        docker update --restart unless-stopped $container
        echo "âœ… $container - Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½"
    else
        echo "âš ï¸  $container - ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
    fi
done

echo "ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐºÐ°:"
docker inspect --format='{{.Name}}: {{.HostConfig.RestartPolicy.Name}}' $(docker ps -aq)

echo "âœ… Ð“Ð¾Ñ‚Ð¾Ð²Ð¾!"
EOF

chmod +x enable_restart.sh

================================================================================
Ð¨ÐÐ“ 13: ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ ÐÐ’Ð¢ÐžÐ—ÐÐŸÐ£Ð¡ÐšÐ Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ«
================================================================================

# Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ systemd ÑÐµÑ€Ð²Ð¸Ñ Ð´Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð·Ð°Ð¿ÑƒÑÐºÐ°
sudo tee /etc/systemd/system/acs.service > /dev/null << EOF
[Unit]
Description=ACS Data Collection Service
Requires=docker.service
After=docker.service

[Service]
Type=oneshot
RemainAfterExit=yes
WorkingDirectory=/root/data-collection-service/client
ExecStart=/usr/local/bin/docker-compose up -d
ExecStop=/usr/local/bin/docker-compose down
TimeoutStartSec=0

[Install]
WantedBy=multi-user.target
EOF

# ÐŸÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ systemd
sudo systemctl daemon-reload

# Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ð°Ð²Ñ‚Ð¾Ð·Ð°Ð¿ÑƒÑÐº
sudo systemctl enable acs.service

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ
sudo systemctl status acs.service

================================================================================
ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð£Ð¡Ð¢ÐÐÐžÐ’ÐšÐ˜
================================================================================

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð²ÑÐµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹
echo "=== ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ« ==="
echo "Docker Ð²ÐµÑ€ÑÐ¸Ñ:"
docker --version

echo "Docker Compose Ð²ÐµÑ€ÑÐ¸Ñ:"
docker-compose --version

echo "Ð¡Ñ‚Ð°Ñ‚ÑƒÑ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²:"
docker compose ps

echo "Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²:"
docker stats --no-stream

echo "Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ñ„Ð°Ð¹Ñ€Ð²Ð¾Ð»Ð°:"
sudo ufw status

echo "Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð°Ð²Ñ‚Ð¾Ð·Ð°Ð¿ÑƒÑÐºÐ°:"
sudo systemctl status acs.service

echo "=== ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð—ÐÐ’Ð•Ð Ð¨Ð•ÐÐ ==="

================================================================================
Ð£ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð• Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐžÐ™
================================================================================

# ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
docker compose down

# Ð—Ð°Ð¿ÑƒÑÐº ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
docker compose up -d

# ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
docker compose restart

# ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð»Ð¾Ð³Ð¾Ð²
docker compose logs

# ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð»Ð¾Ð³Ð¾Ð² ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð³Ð¾ ÑÐµÑ€Ð²Ð¸ÑÐ°
docker compose logs upload_data

# ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
docker compose pull
docker compose up -d

# ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð°Ð²Ñ‚Ð¾Ð·Ð°Ð¿ÑƒÑÐºÐ°
sudo systemctl disable acs.service

# Ð’ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð°Ð²Ñ‚Ð¾Ð·Ð°Ð¿ÑƒÑÐºÐ°
sudo systemctl enable acs.service

================================================================================
Ð£Ð¡Ð¢Ð ÐÐÐ•ÐÐ˜Ð• ÐÐ•ÐŸÐžÐ›ÐÐ”ÐžÐš
================================================================================

# Ð•ÑÐ»Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÑŽÑ‚ÑÑ:
docker compose logs
docker compose config

# Ð•ÑÐ»Ð¸ ClickHouse Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½:
docker compose logs my_clickhouse
curl http://localhost:8123/ping

# Ð•ÑÐ»Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ñ Ð¿Ð°Ð¼ÑÑ‚ÑŒÑŽ:
docker stats
docker system prune -a

# Ð•ÑÐ»Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ñ ÑÐµÑ‚ÑŒÑŽ:
docker network ls
docker network inspect client_default

# ÐŸÐ¾Ð»Ð½Ð°Ñ Ð¿ÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°:
docker compose down
docker system prune -a
docker compose up -d

================================================================================
Ð¨ÐÐ“ 10: Ð‘Ð•Ð—ÐžÐŸÐÐ¡ÐÐžÐ¡Ð¢Ð¬ Ð˜ ÐžÐŸÐ¢Ð˜ÐœÐ˜Ð—ÐÐ¦Ð˜Ð¯ CLICKHOUSE
================================================================================

# âš ï¸ Ð’ÐÐ–ÐÐž: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ ClickHouse
# 1. Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð¿Ð°Ñ€Ð¾Ð»Ð¸ Ð² users.xml Ð½Ð° ÑÐ»Ð¾Ð¶Ð½Ñ‹Ðµ
# 2. ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÑŒÑ‚Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ð¿Ð¾ IP Ð°Ð´Ñ€ÐµÑÐ°Ð¼
# 3. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ñ€Ð²Ð¾Ð» Ð´Ð»Ñ Ð¿Ð¾Ñ€Ñ‚Ð¾Ð² 8123 Ð¸ 9000

# ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ñ„Ð°Ð¹Ñ€Ð²Ð¾Ð»Ð° (Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ YOUR_IP Ð½Ð° Ð²Ð°Ñˆ IP)
# sudo ufw allow from YOUR_IP to any port 8123
# sudo ufw allow from YOUR_IP to any port 9000
# sudo ufw deny 8123
# sudo ufw deny 9000

# Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ Ð´Ð»Ñ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ ÑÐ±Ð¾Ñ€Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…
docker exec -it my_clickhouse clickhouse-client --query "
CREATE TABLE IF NOT EXISTS acs_data.collection (
    platform String,
    client_name String,
    report_name String,
    date Date,
    status String,
    created_at DateTime DEFAULT now()
) ENGINE = MergeTree()
ORDER BY (platform, client_name, report_name, date)
"

# Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Merge Ð´Ð»Ñ Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…
docker exec -it my_clickhouse clickhouse-client --query "
CREATE TABLE IF NOT EXISTS acs_data.ozon_all AS acs_data.ozon_test_1
ENGINE = Merge(currentDatabase(), '^ozon_')
"

# Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ð¿Ñ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ¸
docker exec -it my_clickhouse clickhouse-client --query "
CREATE VIEW IF NOT EXISTS acs_data.sales_summary AS
SELECT 
    platform,
    client_name,
    toDate(created_at) as date,
    count() as records_count
FROM acs_data.collection
WHERE status = 'success'
GROUP BY platform, client_name, date
ORDER BY date DESC
"

================================================================================
Ð¨ÐÐ“ 11: Ð£ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð• Ð”ÐÐÐÐ«ÐœÐ˜ Ð’ CLICKHOUSE
================================================================================

# ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð²ÑÐµÑ… Ð±Ð°Ð· Ð´Ð°Ð½Ð½Ñ‹Ñ…
docker exec -it my_clickhouse clickhouse-client --query "SHOW DATABASES"

# ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ñ‚Ð°Ð±Ð»Ð¸Ñ† Ð² Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…
docker exec -it my_clickhouse clickhouse-client --query "SHOW TABLES FROM acs_data"

# ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹
docker exec -it my_clickhouse clickhouse-client --query "DESCRIBE acs_data.collection"

# Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÑÐ±Ð¾Ñ€Ð° (Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð´Ð°Ñ‚Ñƒ Ð½Ð° Ð½ÑƒÐ¶Ð½ÑƒÑŽ)
# docker exec -it my_clickhouse clickhouse-client --query "DELETE FROM acs_data.collection WHERE date = '2025-10-23'"

# ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†
docker exec -it my_clickhouse clickhouse-client --query "OPTIMIZE TABLE acs_data.collection"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð°Ð·Ð¼ÐµÑ€Ð° Ñ‚Ð°Ð±Ð»Ð¸Ñ†
docker exec -it my_clickhouse clickhouse-client --query "
SELECT 
    database,
    table,
    formatReadableSize(sum(bytes)) as size
FROM system.parts 
WHERE active = 1
GROUP BY database, table
ORDER BY sum(bytes) DESC
"

================================================================================
Ð¨ÐÐ“ 12: TELEGRAM Ð£Ð’Ð•Ð”ÐžÐœÐ›Ð•ÐÐ˜Ð¯
================================================================================

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Telegram Ð±Ð¾Ñ‚Ð°:
# 1. Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð±Ð¾Ñ‚Ð° Ñ‡ÐµÑ€ÐµÐ· @BotFather
# 2. ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚Ðµ Ñ‚Ð¾ÐºÐµÐ½ Ð±Ð¾Ñ‚Ð°
# 3. Ð£Ð·Ð½Ð°Ð¹Ñ‚Ðµ ÑÐ²Ð¾Ð¹ ID Ñ‡ÐµÑ€ÐµÐ· @userinfobot
# 4. Ð”Ð»Ñ Ð³Ñ€ÑƒÐ¿Ð¿Ð¾Ð²Ñ‹Ñ… Ñ‡Ð°Ñ‚Ð¾Ð²: Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð±Ð¾Ñ‚Ð° Ð² Ð³Ñ€ÑƒÐ¿Ð¿Ñƒ Ñ Ð°Ð´Ð¼Ð¸Ð½ÑÐºÐ¸Ð¼Ð¸ Ð¿Ñ€Ð°Ð²Ð°Ð¼Ð¸
# 5. ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚Ðµ chat_id Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ Ñ‡ÐµÑ€ÐµÐ· API: https://api.telegram.org/botTOKEN/getUpdates

# ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð² settings.xlsx:
# - TELEGRAM_BOT_TOKEN: Ð²Ð°Ñˆ Ñ‚Ð¾ÐºÐµÐ½ Ð¾Ñ‚ BotFather
# - TELEGRAM_CHAT_ID: Ð²Ð°Ñˆ Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ ID Ð¸Ð»Ð¸ ID Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ (Ñ Ð¼Ð¸Ð½ÑƒÑÐ¾Ð¼)
# - TELEGRAM_NOTIFICATIONS: Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ/Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ

================================================================================
ÐŸÐžÐ›Ð•Ð—ÐÐ«Ð• ÐšÐžÐœÐÐÐ”Ð«
================================================================================

# ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð²ÑÐµÑ… ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²
docker ps -a

# ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð²ÑÐµÑ… Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²
docker images

# ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ ÑÐµÑ‚ÐµÐ¹
docker network ls

# ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ñ‚Ð¾Ð¼Ð¾Ð²
docker volume ls

# ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð½ÐµÐ¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼Ñ‹Ñ… Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²
docker system prune -a

# ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð»Ð¾Ð³Ð¾Ð² Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸
docker compose logs -f

# Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´ Ð² ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ðµ
docker compose exec upload_data bash

================================================================================
ÐšÐžÐÐ¢ÐÐšÐ¢Ð« ÐŸÐžÐ”Ð”Ð•Ð Ð–ÐšÐ˜
================================================================================

ðŸ“§ Email: abovyan.mg@gmail.com
ðŸ™ GitHub: https://github.com/abovyanmg/data-collection-service
ðŸ“‹ Issues: https://github.com/abovyanmg/data-collection-service/issues

================================================================================
Ð‘Ð›ÐÐ“ÐžÐ”ÐÐ ÐÐžÐ¡Ð¢Ð˜
================================================================================

Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð·Ð° Ð±Ð°Ð·Ð¸Ñ: Morinad
ÐžÑÐ¾Ð±Ð°Ñ Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ð½Ð¾ÑÑ‚ÑŒ ÐÐ»ÐµÐºÑÐ°Ð½Ð´Ñ€Ñƒ ÐœÐ¾Ñ€Ð¸Ð½Ñƒ (@alexdirect) - ÑÑ‚Ð¾ ÑÐµÐ½ÑÐµÐ¹ Ð¸ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº, 
ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¼Ñƒ Ñ Ð¾Ñ‡ÐµÐ½ÑŒ Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€ÐµÐ½ Ð·Ð° Ð·Ð½Ð°Ð½Ð¸Ñ Ð¸ Ð²Ð´Ð¾Ñ…Ð½Ð¾Ð²ÐµÐ½Ð¸Ðµ.

================================================================================
Ð Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ð¾: AbovyansConsultingServices
ÐžÑÐ½Ð¾Ð²Ð°Ð½Ð¾ Ð½Ð° Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ñ‚ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸ÑÑ…
================================================================================
